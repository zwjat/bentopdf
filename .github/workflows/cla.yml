name: "CLA Assistant"

on:
  issue_comment:
    types: [created]
  pull_request_target:
    types: [opened, closed, synchronize]

# Permissions needed for the workflow
permissions:
  actions: write
  contents: write
  pull-requests: write
  statuses: write

jobs:
  cla-check:
    runs-on: ubuntu-latest
    if: >
      github.event_name == 'pull_request_target' ||
      (
        github.event_name == 'issue_comment' &&
        github.event.issue.pull_request &&
        (
          github.event.comment.body == 'recheck' ||
          github.event.comment.body == 'I have read the CLA Document and I hereby sign the CLA'
        )
      )
    steps:
      - name: "CLA Assistant"
        uses: cla-assistant/github-action@v2.5.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PERSONAL_ACCESS_TOKEN: ${{ secrets.CLA_ASSISTANT_TOKEN }}
        with:
          path-to-signatures: 'signatures/cla.json'
          path-to-document: 'https://github.com/${{ github.repository }}/blob/main/ICLA.md'
          
          # Branch to store signatures
          branch: 'main'
          
          # Allowlist for bot accounts (won't need to sign CLA)
          allowlist: 'bot*,*[bot],dependabot*,renovate*,github-actions*'
          
          # Custom messages
          custom-notsigned-prcomment: |
            ## CLA Signature Required
            
            Thank you for your contribution! Before we can accept your pull request, you need to sign our [Contributor License Agreement (CLA)](https://github.com/${{ github.repository }}/blob/main/ICLA.md).
            
            ### Why do we need a CLA?
            
            pdfup uses a dual licensing model (AGPL-3.0 for open source + commercial license). The CLA allows us to:
            - Include your contributions in both open source and commercial versions
            - Protect you and us legally
            - Keep the project sustainable
            
            ### How to sign
            
            To sign the CLA, please comment on this PR with:
            
            ```
            I have read the CLA Document and I hereby sign the CLA
            ```
            
            **For corporate contributions**, please have your organization sign our [Corporate CLA (CCLA)](https://github.com/${{ github.repository }}/blob/main/CCLA.md) by contacting us at contact@pdfup.org.
            
            ---
            
            ⚠️ **Note**: You only need to sign the CLA once. Future contributions to this repository will not require re-signing.
          
          custom-pr-sign-comment: 'I have read the CLA Document and I hereby sign the CLA'
          
          # Lock PR while waiting for CLA signature
          lock-pullrequest-aftermerge: false
          
          # Use issues to store signatures (alternative to branch storage)
          use-dco-flag: false
